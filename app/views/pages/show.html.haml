%p
  %b Public page:
  = link_to @page.name, "#{request.protocol}#{request.host}:#{request.port}/#{@page.slug}"

%p
  %b QR Code:
  #page_qr
  :javascript
    $(function() {    
      $('div#page_qr').qrcode("#{request.protocol}#{request.host}:#{request.port}/#{@page.slug}");
    });
    
    function uploadFile() {
      var fd = new FormData();
      fd.append("fileToUpload", document.getElementById('fileToUpload').files[0]);
      var xhr = new XMLHttpRequest();
      xhr.upload.addEventListener("progress", uploadProgress, false);
      xhr.addEventListener("load", uploadComplete, false);
      xhr.addEventListener("error", uploadFailed, false);
      xhr.addEventListener("abort", uploadCanceled, false);
      xhr.open("POST", "addLogo.xml");
      xhr.send(fd);
    }

    function uploadProgress(evt) {
      if (evt.lengthComputable) {
        var percentComplete = Math.round(evt.loaded * 100 / evt.total);
        document.getElementById('progressNumber').innerHTML = percentComplete.toString() + '%';
      }
      else {
        document.getElementById('progressNumber').innerHTML = 'unable to compute';
      }
    }

    function uploadComplete(evt) {
      /* This event is raised when the server send back a response */
      alert(evt.target.responseText);
    }

    function uploadFailed(evt) {
      alert("There was an error attempting to upload the file.");
    }

    function uploadCanceled(evt) {
      alert("The upload has been canceled by the user or the browser dropped the connection.");
    }

%body
%p#notice= notice

%p
  %b Name:
  = @page.name
%p
  %b Google checkout merchant:
  = @page.google_checkout_merchant_id

= link_to 'Edit', edit_page_path(@page)
\|
= link_to 'Back', pages_path

%p
  %form#payment{:action => "addLogo.xml", :enctype => "multipart/form-data", :method => "post"}
    .row
      %legend Setup Custom Logo
      %ol
        %li
          %br/
          %input#fileToUpload{:name => "fileToUpload", :onchange => "fileSelected();", :type => "file"}/
          #fileName
          #fileSize
          #fileType
        .row
        %li
          %input{:onclick => "uploadFile()", :type => "button", :value => "Upload"}/
          #progressNumber


= link_to 'Edit', edit_page_path(@page)
\|
= link_to 'Back', pages_path
